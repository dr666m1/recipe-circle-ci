version: 2.1

orbs:
  # See https://circleci.com/docs/slack-orb-tutorial/
  slack: circleci/slack@4.9.3

jobs:
  minimumJob:
    docker:
      # auth is not required at this time
      # See https://circleci.com/docs/private-images/ 
      - image: cimg/base:2022.05
    steps:
      - run: echo "Hello CircleCI!"
  checkoutJob:
    docker:
      - image: cimg/base:2022.05
    steps:
      - checkout
      - run:
          name: show files
          command: ls -al
  envJob:
    docker:
      - image: cimg/base:2022.05
        environment:
          CONTAINER_ENV: container
    steps:
      - run:
          command: |
            echo $STEP_ENV
            echo $CONTAINER_ENV
          environment:
            STEP_ENV: step
  approvedJob:
    docker:
      - image: cimg/base:2022.05
    steps:
      - run: echo 'approved!'
      # make sure that this is the final step
      - slack/notify:
          event: pass
          template: basic_success_1

workflows:
  mainWorkflow:
    jobs:
      - minimumJob
      - checkoutJob
      - envJob
  holdWorkflow:
    jobs:
      - waitJob:
          # you do not have to define the job in jobs section
          type: approval
      - approvedJob:
          requires:
            - waitJob
          context: slack-secrets
